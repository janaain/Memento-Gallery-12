<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/criaralbum.css">
    <script src="javascript/criaralbum.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <title>Memento Gallery</title>
    
</head>
<body>
    <div class="main" id="main">
        <div id="header"></div>

        <div class="top_bar">
            <a href="index.html" ><img src="Images/homepage.png" class="homepage"></a>
            <span>Criação de Albuns</span>
        </div>

        <div class="menu">
                <ul>
                    <li id="step"><h2 onclick="setCurrentStep(1)">1. Adicionar Fotos</h2>
                        <h5>Clique em 'Adicionar Fotos' para começar.</h5>
                    </li>
                    <li id="step" class="disabled"><h2 onclick="setCurrentStep(2)">2. Seleção de Critérios</h2>
                        <h5>Selecione os critérios pelos quais as fotos serão adicionadas ao álbum.</h5> 
                    </li>
                    <li id="step" class="disabled"><h2 onclick="setCurrentStep(3)">3. Revisão e Conclusão</h2>
                        <h5> Dê um nome ao álbum. Reveja as fotografias e aprecie!</h5>  
                    </li">
                </ul>
        </div>
        <div class="content" id="Cphotos">
            <div class="photos" id="photos">
                <input type="file" id="fileInput" style="display: none;" multiple accept="image/*">
                <div class="images" id="addPhotos"><img src="Images/plus.png"><br><label>Adicionar Fotos</label></div>
            </div>
        </div>
        <div class="content" id="Ccriterios">
            <div class="criterios" id="criterios">
                <!-- Coluna da Esquerda - Organizar Por -->
                <div class="column">
                    <h3>ORGANIZAR POR:</h3>
                    <ul>
                        <li>
                            <input type="radio" name="organizar" id="nao_dividir" checked>
                            <label for="nao_dividir">Colocar todas as fotos no álbum</label>
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="data">
                            <label for="data">Data</label>
                            <br>
                            <label for="data_inicio">De:</label>
                            <input type="date" id="data_inicio">
                            <label for="data_fim">Até:</label>
                            <input type="date" id="data_fim">
                        </li>
                        <li>
                            <div>
                                <label for="locationInput">Localização:</label>
                                <input type="text" id="locationInput" name="location" placeholder="Clique no mapa para selecionar a localização" />
                              </div>
                              <div id="map" style="z-index: 1000; height: 300px; width: 300px; position: absolute; bottom: 20px; right: 20px;"></div>                              
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="qualidade">
                            <label for="qualidade">Qualidade</label>
                            <br>
                            <label for="qualidade_min">De:</label>
                            <input type="number" id="qualidade_min" placeholder="Mínima">
                            <label for="qualidade_max">Até:</label>
                            <input type="number" id="qualidade_max" placeholder="Máxima">
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="resolucao">
                            <label for="resolucao">Proporção</label>
                            <br>
                            <label for="resolucao_min">De:</label>
                            <input type="number" id="resolucao_min" placeholder="Mínima">
                            <label for="resolucao_max">Até:</label>
                            <input type="number" id="resolucao_max" placeholder="Máxima">
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="pessoa">
                            <label for="pessoa">Pessoa</label>
                            <br>
                            <input type="text" id="pessoa_valor" placeholder="Especificar pessoa">
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="tipo">
                            <label for="tipo">Tipo (Macro, Paisagem, etc.)</label>
                            <br>
                            <input type="text" id="tipo_valor" placeholder="Especificar tipo">
                        </li>
                        <li>
                            <input type="checkbox" name="organizar" id="conteudo">
                            <label for="conteudo">Conteúdo</label>
                            <br>
                            <input type="text" id="conteudo_valor" placeholder="Especificar conteúdo">
                        </li>
                    </ul>
                </div>
        
                <!-- Coluna da Direita - Manter de Fora -->
                <div class="column">
                    <h3>MANTER DE FORA:</h3>
                    <ul>
                        <li><input type="checkbox" id="desfocada"> <label for="desfocada">Desfocadas</label></li>
                        <li><input type="checkbox" id="duplicada"> <label for="duplicada">Duplicadas</label></li>
                        <li><input type="checkbox" id="ma_iluminacao"> <label for="ma_iluminacao">Má Iluminação</label></li>
                        <li><input type="checkbox" id="baixa_resolucao"> <label for="baixa_resolucao">Baixa Resolução</label></li>
                    </ul>
                </div>
            </div>
        
            <!-- Adicionar Mapa no Canto Inferior Direito -->
            <div id="map" style="height: 300px; width: 300px; position: absolute; bottom: 20px; right: 20px;"></div>
                <!-- Aqui vai o mapa -->
            </div>
        </div>
        
        <div class="content" id="Crever">
            <div class="nomeAlbum">
                <label for="album-name">Nome do Álbum:</label>
                <input type="text" id="album-name" placeholder="Nome">
            </div>
            <div class="content" id="fiches">
            </div>
        </div>
            
            <div>
                <button class="next" id="next">Próximo Passo</button>               
            </div>
            <div>
                <button class="prev" id="prev">Passo Anterior</button>               
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
          var map = L.map('map').setView([51.505, -0.09], 13);
    
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);
    
          var currentMarker = null;
          var locationInput = document.getElementById('locationInput');
    
          // Function to perform reverse geocoding
          function reverseGeocode(lat, lng) {
            locationInput.value = "A carregar...";  // Show loading message
            var url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1`;
    
            fetch(url)
              .then(response => response.json())
              .then(data => {
                // Extract specific fields: road, city, country
                var address = data.address;
                var road = address.road || '';
                var city = address.city || address.town || address.village || '';  // Get available field
                var country = address.country || '';
                
                // Concatenate the fields
                var locationName = `${road}, ${city}, ${country}`.trim();
    
                if (currentMarker) {
                  map.removeLayer(currentMarker);
                }
    
                // Set marker and display place name in input
                currentMarker = L.marker([lat, lng]).addTo(map)
                  .bindPopup(locationName)
                  .openPopup();
    
                locationInput.value = locationName;  // Update input with the place name
              })
              .catch(error => {
                console.log('Erro ao fazer reverse geocoding:', error);
                locationInput.value = "Erro ao obter a localização";
              });
          }
    
          function onMapClick(e) {
            reverseGeocode(e.latlng.lat, e.latlng.lng);
          }
    
          map.on('click', onMapClick);
        });
      </script>
      
      

</body>
</html>
